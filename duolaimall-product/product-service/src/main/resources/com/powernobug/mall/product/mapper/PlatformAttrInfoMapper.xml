<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.powernobug.mall.product.mapper.PlatformAttrInfoMapper">
    <resultMap id="PlatformAttrInfo" type="com.powernobug.mall.product.model.PlatformAttributeInfo">
        <id column="id" property="id"/>
        <result column="attr_name" property="attrName"/>
        <result column="category_id" property="categoryId"/>
        <result column="category_level" property="categoryLevel"/>

        <collection property="attrValueList" ofType="com.powernobug.mall.product.model.PlatformAttributeValue">
            <id column="bid" property="id"/>
            <result column="value_name" property="valueName"/>
            <result column="attr_id" property="attrId"/>
        </collection>
    </resultMap>

    <select id="selectPlatFormAttrInfoList" resultMap="PlatformAttrInfo" >
        select a.id,
        a.attr_name,
        a.category_id,
        a.category_level,
        b.id as bid,
        b.value_name,
        b.attr_id
    from mall_product.platform_attr_info as a
        inner join mall_product.platform_attr_value as b on a.id=b.attr_id
            and a.is_deleted=0
            and b.is_deleted=0
        <where>
                <if test="firstLevelCategoryId != 0">
                   OR (category_id = #{firstLevelCategoryId} AND category_level = 1)
                </if>
                <if test="secondLevelCategoryId != 0">
                   OR (category_id = #{secondLevelCategoryId} AND category_level = 2)
                </if>
                <if test="thirdLevelCategoryId != 0">
                   OR (category_id = #{thirdLevelCategoryId} AND category_level = 3)
                </if>
        </where>

    </select>
</mapper>